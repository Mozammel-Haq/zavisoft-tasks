[phases.setup]
nixPkgs = ["php82", "php82Extensions.pdo", "php82Extensions.pdo_pgsql", "php82Extensions.mbstring", "php82Extensions.tokenizer", "php82Extensions.xml", "php82Extensions.ctype", "php82Extensions.json", "php82Extensions.bcmath", "php82Extensions.gd", "php82Extensions.zip", "php82Extensions.sodium", "php82Extensions.opcache", "php82Extensions.pcntl", "composer_2_4"]

[phases.install]
cmds = ["composer install --no-dev --optimize-autoloader --no-interaction --prefer-dist"]

[phases.build]
cmds = [
    "php artisan config:clear",
    "php artisan config:cache",
    "php artisan route:cache",
    "php artisan view:cache"
]

[start]
cmd = "php artisan migrate --force && php artisan db:seed --force && php artisan passport:install --force && openssl rsa -in storage/oauth-private.key -out storage/oauth-private.key 2>/dev/null || true && chmod 600 storage/oauth-private.key storage/oauth-public.key && php-fpm8.2 -D && nginx -g 'daemon off;'"
